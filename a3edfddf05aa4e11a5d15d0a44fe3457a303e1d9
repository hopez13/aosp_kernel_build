{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3f7a953a_6473aafa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-08-13T23:33:19Z",
      "side": 1,
      "message": "should I review this?",
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2c8a222_56f96115",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-08-13T23:41:19Z",
      "side": 1,
      "message": "nit: Just `: \u003e ${{OUT_DIR}}/modules.order`? Then we have one less execvp.\n\nOr just `rm` it",
      "range": {
        "startLine": 1328,
        "startChar": 19,
        "endLine": 1328,
        "endChar": 33
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0841a9a_e58796e8",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1557540
      },
      "writtenOn": "2024-08-14T00:00:55Z",
      "side": 1,
      "message": "The file has to exist for the echo and sed commands below to work. Otherwise I hit the error \"modules.order\" doesn\u0027t exist. I\u0027ll try the `: \u003e ...` option.",
      "parentUuid": "f2c8a222_56f96115",
      "range": {
        "startLine": 1328,
        "startChar": 19,
        "endLine": 1328,
        "endChar": 33
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3cb0234_d8c35bce",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1330,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-08-13T23:41:19Z",
      "side": 1,
      "message": "https://www.kernel.org/doc/Documentation/kbuild/kbuild.txt\n\n\n```\nmodules.order\n--------------------------------------------------\nThis file records the order in which modules appear in Makefiles. This\nis used by modprobe to deterministically resolve aliases that match\nmultiple modules.\n```\n\nSo technically, this is unordered. Do you know if we later rely on the fact that this file is ordered? Is it okay to drop the assumption that it is ordered?\nDoes `make modules_install` re-generate it? Do we discard the file after this Bazel action is finished?\n\nThe answers to these questions will affect how much impact is created by making `modules.order` unordered.",
      "range": {
        "startLine": 1330,
        "startChar": 23,
        "endLine": 1330,
        "endChar": 107
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23169e42_3f51e9de",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1330,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-08-13T23:42:30Z",
      "side": 1,
      "message": "Also, how hard is it to let Kbuild generate it for us in the single-module build case? Is it a very invasive change in Kbuild?0",
      "parentUuid": "f3cb0234_d8c35bce",
      "range": {
        "startLine": 1330,
        "startChar": 23,
        "endLine": 1330,
        "endChar": 107
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a6dd0e4_7a357ecf",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1330,
      "author": {
        "id": 1557540
      },
      "writtenOn": "2024-08-14T00:00:55Z",
      "side": 1,
      "message": "Kbuild does generate a modules.order file (based on the command line order you provide), but then it deletes it at the end of the build claiming it\u0027s not the real one [1](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Makefile?h\u003dv6.11-rc3#n1911). I need to check with the upstream maintainer to see if there\u0027s another command to generate a proper one. I would say that (1) module ordering is not used for single_module builds because kbuild will compile the modules in the order you provide them, and (2) I don\u0027t think Android really uses aliases to load kernel modules since we use `module.load` files that list all the modules we want to load instead of auto-loading modules via the device tree compatible strings and aliases.\n\nWith fw_devlink enabled in GKI, module load ordering should theoretically not matter (although there are still some edge cases here). If someone does run into issues with this, then you can re-order the modules in their `make_goals` to load them in a different order or they use a `modules_softdep` to change the load ordering.",
      "parentUuid": "23169e42_3f51e9de",
      "range": {
        "startLine": 1330,
        "startChar": 23,
        "endLine": 1330,
        "endChar": 107
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4ab0254_0daba71a",
        "filename": "kleaf/impl/kernel_build.bzl",
        "patchSetId": 5
      },
      "lineNbr": 1330,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2024-08-14T00:09:42Z",
      "side": 1,
      "message": "Thanks for your explanation. For future reference, could you please provide a summary in the code next to the line where modules.order is generated?",
      "parentUuid": "1a6dd0e4_7a357ecf",
      "range": {
        "startLine": 1330,
        "startChar": 23,
        "endLine": 1330,
        "endChar": 107
      },
      "revId": "a3edfddf05aa4e11a5d15d0a44fe3457a303e1d9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}